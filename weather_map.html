<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Weather-Map-Project</title>

    <!-- mapBox CSS -->
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.css' rel='stylesheet'/>
    <!-- Custom CSS -->
    <style>


        html, body {
            background-color: cornflowerblue;

        }

        img {

            width: 60px;
            height: 40px;

        }


        #map {
            /* the width and height may be set to any size */
            width: 100%;
            height: 400px;


        }


        .wrapper {
            border-style: solid;
        }


        .pageWrapper {
            padding-right: 10%;
            padding-left: 10%;
            align-content: center;

        }

        .column {


            float: left;
            width: 33.33%;
            text-align: center;
            align-content: center;
            color: white;


        }

        .three-day-forecast {

            content: "";
            display: table;
            clear: both;
            width: 100%;
            height: 150px;
            background-color: grey;
            margin-bottom: 2.5%;


        }


    </style>
</head>
<body>

<h1>Weather Application</h1>


Latitude: <input id = "lat" type="text" name="lat" ><br>
Longitude: <input id = "long" type="text" name="long"><br>



<h2 class="city"></h2>

<div class="pageWrapper">

    <div class="three-day-forecast"></div>


    <!-- The HTML element that serves as the Mapbox container -->
    <div id='map'></div>

</div>

<!--Private Access Code to Dark Sky and mapBox-->

<script src="js/keys.js"></script>

<!--jquery library-->

<script src="js/jquery-3.3.1.js"></script>

<!-- Mapbox JS -->
<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.js'></script>

<!--Access to ajax library-->

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>


<!--Custom javascript-->

<script>

    (function () {
            "use strict";


            //  var latitude = $('#lat').val();
            //  var longitude = $('#long').val();
            //
            // console.log($('#lat').val());
            //  console.log($('#long').val());


            mapboxgl.accessToken = mapboxglaccessToken;


            var map = new mapboxgl.Map({
                container: 'map',
                style: 'mapbox://styles/mapbox/streets-v9',
                center: [-98.5795, 39.828175],
                zoom: 3


            });

            var marker = new mapboxgl.Marker({
                draggable: true
            });

            marker.setLngLat([-98.491142, 29.424349]);
            $("#lat").append().attr("value", -98.491142);
            $("#long").append().attr("value", 29.424349);
            marker.addTo(map);


        // marker.on('dragend', function() {
        //     var cordination = ('/' + marker._lngLat.lat + ',' + marker._lngLat.lng);
        //     console.log(cordination);

            function onDragEnd() {

                $('.three-day-forecast').html('');


                var lngLat = marker.getLngLat();
                $("#lat").append().attr("value", marker._lngLat.lat);
                $("#long").append().attr("value", marker._lngLat.lng);
                var coordination = ('/' + marker._lngLat.lat + ',' + marker._lngLat.lng);


                $.get("https://cors-anywhere.herokuapp.com/https://api.darksky.net/forecast/" + darkSkySecretCode + coordination).done(function (weather) {
                    //loop

                    console.log(weather.daily.data[0]);
                    console.log(weather.daily.data[1]);
                    console.log(weather.daily.data[2]);
                    console.log(weather.daily.data[0].temperatureLow);
                    console.log(weather.daily.data[0].temperatureHigh);
                    console.log(weather.daily.data[0].summary);
                    console.log(weather.daily.data[0].humidity);
                    console.log(weather.daily.data[0].windSpeed);
                    console.log(weather.daily.data[0].pressure);


                    var timeConversion = new Date((weather.daily.data[0].time * 1000));
                    console.log(timeConversion.toString());


                    //Three day forecast to have. I need a daily forecast of icon, summary, humidity, windspeed round, pressure, average temperature high and low.

                    // icon optional
                    // A machine-readable text summary of this data point, suitable for selecting an icon for display.
                    // If defined, this property will have one of the following values: clear-day, clear-night, rain, snow, sleet, wind, fog, cloudy, partly-cloudy-day,
                    // or partly-cloudy-night. (Developers should ensure that a sensible default is defined, as additional values, such as hail, thunderstorm, or tornado,
                    // may be defined in the future.)


                    //Create an array of JS objects containing a property for each of the following conditions: clear-day, clear-night, rain, snow, sleet, wind, fog, cloudy, partly-cloudy-day, partly-cloudy-night.


                    var conditionsArrayObjects = [

                        {
                            icon: "partly-cloudy-day",

                            img: $('<img />', {
                                id: 'iconIDCloud',
                                src: "icon/cloudy.png",
                                alt: "iconAlt"
                            })


                        },

                        {
                            icon: 'rain',

                            img: $('<img />', {
                                id: 'iconIDRain',
                                src: "icon/rain.png",
                                alt: "iconAlt"
                            })
                        },

                        {
                            icon: 'sunny',

                            img: $('<img />', {
                                id: 'iconIDSunny',
                                src: "icon/Sunny.png",
                                alt: "iconAlt"
                            })
                        }


                    ];

                    //Add a property to the array of icon objects for the url to the location that the appropriate icon is stored locally.


                    for (var i = 0; i < 3; i++) {


                        $('.three-day-forecast').append('<div class="column">' + '<div class="wrapper">' +
                            '<h2>' + weather.daily.data[i].temperatureLow + "&#176/" + weather.daily.data[i].temperatureHigh + "&#176" + '</h2>' +
                            '<h2 class="appendIcon">' +
                            '<h4>' + weather.daily.data[i].icon + '</h4>' + '</h2>' +
                            '<h4>' + 'Humidity: ' + weather.daily.data[i].humidity + '</h4>' +
                            '<h4>' + 'wind: ' + weather.daily.data[i].windSpeed + '</h4>' +
                            '<h4>' + 'Pressure: ' + weather.daily.data[i].pressure + '</h4>' +
                            '</div>' + '</div>');



                        //Fix Icons looping

                        for (var j = 0; j < conditionsArrayObjects.length; j++) {


                            if (weather.daily.data[i].icon === conditionsArrayObjects[j].icon) {


                                $('.appendIcon').html('');

                                conditionsArrayObjects[j].img.appendTo($('.appendIcon'));

                            }


                        }


                    }

                });

            }

            marker.on('dragend', onDragEnd);




            var latitude = "-98.491142";
            var longitude = "29.424349";
            // 29.424349,-98.491142 (San Antonio)
            // 40.646061, -111.497971 (Park City)


            $.get("https://cors-anywhere.herokuapp.com/https://api.darksky.net/forecast/" + darkSkySecretCode + "/29.424349,-98.491142").done(function (weather) {
                //loop

                console.log(weather.daily.data[0]);
                console.log(weather.daily.data[1]);
                console.log(weather.daily.data[2]);
                console.log(weather.daily.data[0].temperatureLow);
                console.log(weather.daily.data[0].temperatureHigh);
                console.log(weather.daily.data[0].summary);
                console.log(weather.daily.data[0].humidity);
                console.log(weather.daily.data[0].windSpeed);
                console.log(weather.daily.data[0].pressure);


                var timeConversion = new Date((weather.daily.data[0].time * 1000));
                console.log(timeConversion.toString());


                //Three day forecast to have. I need a daily forecast of icon, summary, humidity, windspeed round, pressure, average temperature high and low.

                // icon optional
                // A machine-readable text summary of this data point, suitable for selecting an icon for display.
                // If defined, this property will have one of the following values: clear-day, clear-night, rain, snow, sleet, wind, fog, cloudy, partly-cloudy-day,
                // or partly-cloudy-night. (Developers should ensure that a sensible default is defined, as additional values, such as hail, thunderstorm, or tornado,
                // may be defined in the future.)


                //Create an array of JS objects containing a property for each of the following conditions: clear-day, clear-night, rain, snow, sleet, wind, fog, cloudy, partly-cloudy-day, partly-cloudy-night.


                var conditionsArrayObjects = [

                    {
                        icon: "partly-cloudy-day",

                        img: $('<img />', {
                            id: 'iconIDCloud',
                            src: "icon/cloudy.png",
                            alt: "iconAlt"
                        })


                    },

                    {
                        icon: 'rain',

                        img: $('<img />', {
                            id: 'iconIDRain',
                            src: "icon/rain.png",
                            alt: "iconAlt"
                        })
                    },

                    {
                        icon: 'sunny',

                        img: $('<img />', {
                            id: 'iconIDSunny',
                            src: "icon/Sunny.png",
                            alt: "iconAlt"
                        })
                    }


                ];

                //Add a property to the array of icon objects for the url to the location that the appropriate icon is stored locally.


                for (var i = 0; i < 3; i++) {


                    $('.three-day-forecast').append('<div class="column">' + '<div class="wrapper">' +
                        '<h2>' + weather.daily.data[i].temperatureLow + "&#176/" + weather.daily.data[i].temperatureHigh + "&#176" + '</h2>' +
                        '<h2 class="appendIcon">' +
                        '<h4>' + weather.daily.data[i].icon + '</h4>' + '</h2>' +
                        '<h4>' + 'Humidity: ' + weather.daily.data[i].humidity + '</h4>' +
                        '<h4>' + 'wind: ' + weather.daily.data[i].windSpeed + '</h4>' +
                        '<h4>' + 'Pressure: ' + weather.daily.data[i].pressure + '</h4>' +
                        '</div>' + '</div>');



                    for (var j = 0; j < conditionsArrayObjects.length; j++) {


                        if (weather.daily.data[i].icon === conditionsArrayObjects[j].icon) {


                            $('.appendIcon').html('');

                            conditionsArrayObjects[j].img.appendTo($('.appendIcon'));

                        }


                    }


                }

            });

        }

    )();

</script>

</body>
</html>